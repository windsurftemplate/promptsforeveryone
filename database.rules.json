{
  "rules": {
    "users": {
      "$uid": {
        ".read": "$uid === auth.uid",
        ".write": "$uid === auth.uid",
        "favorites": {
          ".read": "$uid === auth.uid && root.child('users').child(auth.uid).child('isPro').val() === true",
          ".write": "$uid === auth.uid && root.child('users').child(auth.uid).child('isPro').val() === true"
        },
        ".validate": "newData.hasChildren(['email'])",
        "email": { ".validate": "newData.isString()" },
        "isPro": { ".validate": "newData.isBoolean()" },
        "stripeCustomerId": { ".validate": "newData.isString()" },
        "stripeSubscriptionId": { ".validate": "newData.isString() || newData.val() === null" },
        "stripeSubscriptionStatus": { ".validate": "newData.isString()" },
        "plan": { ".validate": "newData.isString() && (newData.val() === 'free' || newData.val() === 'pro')" },
        "updatedAt": { ".validate": "newData.isString()" }
      }
    },
    "prompts": {
      ".read": true,
      ".write": "auth != null",
      "$promptId": {
        ".validate": "newData.hasChildren(['title', 'description', 'content', 'category', 'userId', 'createdAt'])",
        "title": { ".validate": "newData.isString() && newData.val().length > 0" },
        "description": { ".validate": "newData.isString()" },
        "content": { ".validate": "newData.isString() && newData.val().length > 0" },
        "category": { ".validate": "newData.isString()" },
        "userId": { ".validate": "newData.val() === auth.uid" },
        "createdAt": { ".validate": "newData.isString()" },
        "updatedAt": { ".validate": "newData.isString()" }
      }
    },
    "chats": {
      "$uid": {
        ".read": "$uid === auth.uid && root.child('users').child(auth.uid).child('isPro').val() === true",
        ".write": "$uid === auth.uid && root.child('users').child(auth.uid).child('isPro').val() === true",
        "$chatId": {
          ".validate": "newData.hasChildren(['messages', 'createdAt'])",
          "messages": {
            "$messageId": {
              ".validate": "newData.hasChildren(['role', 'content'])",
              "role": { ".validate": "newData.isString() && (newData.val() === 'user' || newData.val() === 'assistant')" },
              "content": { ".validate": "newData.isString()" }
            }
          },
          "createdAt": { ".validate": "newData.isString()" },
          "updatedAt": { ".validate": "newData.isString()" }
        }
      }
    }
  }
}
