{
  "rules": {
    "users": {
      "$uid": {
        ".read": "$uid === auth.uid",
        ".write": "$uid === auth.uid",
        "favorites": {
          ".read": "$uid === auth.uid && root.child('users').child(auth.uid).child('isPro').val() === true",
          ".write": "$uid === auth.uid && root.child('users').child(auth.uid).child('isPro').val() === true"
        },
        ".validate": "newData.hasChildren(['email'])",
        "email": { ".validate": "newData.isString()" },
        "isPro": { ".validate": "newData.isBoolean()" },
        "stripeCustomerId": { ".validate": "newData.isString()" },
        "stripeSubscriptionId": { ".validate": "newData.isString() || newData.val() === null" },
        "stripeSubscriptionStatus": { ".validate": "newData.isString()" },
        "plan": { ".validate": "newData.isString() && (newData.val() === 'free' || newData.val() === 'pro')" },
        "updatedAt": { ".validate": "newData.isString()" }
      }
    },
    "blog": {
      ".read": true,
      ".write": "auth != null && root.child('users').child(auth.uid).child('role').val() === 'admin'",
      "$postId": {
        ".validate": "newData.hasChildren(['title', 'content'])",
        "title": { ".validate": "newData.isString() && newData.val().length > 0" },
        "content": { ".validate": "newData.isString() && newData.val().length > 0" },
        "excerpt": { ".validate": "newData.isString()" },
        "author": { ".validate": "newData.isString()" },
        "date": { ".validate": "newData.isString()" },
        "category": { ".validate": "newData.isString()" },
        "readTime": { ".validate": "newData.isString()" },
        "featured": { ".validate": "newData.isBoolean()" },
        "createdAt": { ".validate": "newData.isString()" }
      }
    },
    "categories": {
      ".read": true,
      ".write": false,
      ".indexOn": ["name"],
      "$categoryId": {
        ".validate": "newData.hasChildren(['name'])",
        "name": { ".validate": "newData.isString() && newData.val().length > 0" },
        "description": { ".validate": "newData.isString()" },
        "icon": { ".validate": "newData.isString()" }
      }
    },
    "prompts": {
      ".read": true,
      ".write": "auth != null",
      ".indexOn": ["category", "userId", "visibility"],
      "$promptId": {
        ".validate": "newData.hasChildren(['title', 'description', 'content', 'category', 'userId', 'createdAt', 'visibility'])",
        "title": { ".validate": "newData.isString() && newData.val().length > 0" },
        "description": { ".validate": "newData.isString()" },
        "content": { ".validate": "newData.isString() && newData.val().length > 0" },
        "category": { ".validate": "newData.isString()" },
        "userId": { ".validate": "newData.val() === auth.uid" },
        "visibility": { ".validate": "newData.isString() && (newData.val() === 'public' || newData.val() === 'private')" },
        "createdAt": { ".validate": "newData.isString()" },
        "updatedAt": { ".validate": "newData.isString()" }
      }
    },
    "chats": {
      "$uid": {
        ".read": "auth != null && $uid === auth.uid",
        ".write": "auth != null && $uid === auth.uid",
        ".indexOn": ["createdAt"],
        "$sessionId": {
          ".validate": "newData.hasChildren(['messages'])",
          "messages": {
            "$messageId": {
              ".validate": "newData.hasChildren(['role', 'content'])",
              "role": { ".validate": "newData.isString()" },
              "content": { ".validate": "newData.isString()" }
            }
          },
          "createdAt": { ".validate": "newData.isString()" }
        }
      }
    }
  }
}
