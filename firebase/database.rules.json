{
  "rules": {
    "prompts": {
      ".read": true,
      ".indexOn": ["category", "tags", "userId", "visibility"],
      "$promptId": {
        // Allow reading any prompt
        ".read": true,
        // Allow writing only if authenticated and either:
        // 1. Creating a new prompt (data doesn't exist)
        // 2. Updating their own prompt
        ".write": "auth != null && (!data.exists() || data.child('userId').val() === auth.uid)",
        // Validate the data structure
        ".validate": "newData.hasChildren(['title', 'description', 'content', 'category', 'tags', 'userId', 'userName', 'createdAt', 'updatedAt', 'likes', 'visibility', 'isPublished'])",
        "title": {
          ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 100"
        },
        "description": {
          ".validate": "newData.isString() && newData.val().length <= 500"
        },
        "content": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "category": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "tags": {
          ".validate": "newData.isArray() && newData.val().length <= 10"
        },
        "userId": {
          ".validate": "newData.isString() && newData.val() === auth.uid"
        },
        "userName": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "createdAt": {
          ".validate": "newData.isString() && newData.val().matches(/^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}.\\d{3}Z$/)"
        },
        "updatedAt": {
          ".validate": "newData.isString() && newData.val().matches(/^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}.\\d{3}Z$/)"
        },
        "likes": {
          ".validate": "newData.isNumber() && newData.val() >= 0"
        },
        "visibility": {
          ".validate": "newData.isString() && (newData.val() === 'public' || newData.val() === 'private')"
        },
        "isPublished": {
          ".validate": "newData.isBoolean()"
        }
      }
    },
    "users": {
      ".read": true,
      "$userId": {
        // Users can only write to their own data
        ".write": "auth != null && auth.uid === $userId",
        "likedPrompts": {
          "$promptId": {
            ".validate": "newData.isBoolean()"
          }
        }
      }
    }
  }
}
